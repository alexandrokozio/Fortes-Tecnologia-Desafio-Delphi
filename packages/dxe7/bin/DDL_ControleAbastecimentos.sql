/******************************************************************************/
/*            Generated by IBExpert 2022.3.8.1 03/04/2022 21:41:15            */
/******************************************************************************/

SET SQL DIALECT 3;

SET NAMES ISO8859_1;

SET CLIENTLIB 'fbclient.dll';

CREATE DATABASE 'ControleAbastecimentos.fdb'
USER 'SYSDBA' PASSWORD 'masterkey'
PAGE_SIZE 16384
DEFAULT CHARACTER SET ISO8859_1 COLLATION ISO8859_1;



/******************************************************************************/
/*                                 Generators                                 */
/******************************************************************************/

CREATE SEQUENCE SEQ_CODIGO_BOMBAS;
ALTER SEQUENCE SEQ_CODIGO_BOMBAS RESTART WITH 0;

CREATE SEQUENCE SEQ_CODIGO_COMBUSTIVEIS;
ALTER SEQUENCE SEQ_CODIGO_COMBUSTIVEIS RESTART WITH 0;

CREATE SEQUENCE SEQ_CODIGO_PRECOS;
ALTER SEQUENCE SEQ_CODIGO_PRECOS RESTART WITH 0;

CREATE SEQUENCE SEQ_CODIGO_TANQUES;
ALTER SEQUENCE SEQ_CODIGO_TANQUES RESTART WITH 0;

CREATE SEQUENCE SEQ_CODIGO_VENDAS;
ALTER SEQUENCE SEQ_CODIGO_VENDAS RESTART WITH 0;



/******************************************************************************/
/*                                   Tables                                   */
/******************************************************************************/



RECREATE TABLE BOMBAS (
    CODIGO         BIGINT NOT NULL,
    CODIGO_TANQUE  BIGINT NOT NULL
);

RECREATE TABLE COMBUSTIVEIS (
    CODIGO     BIGINT NOT NULL,
    DESCRICAO  VARCHAR(100) NOT NULL,
    TIPO       VARCHAR(20) NOT NULL,
    VALOR      FLOAT NOT NULL
);

RECREATE TABLE ITENS_VENDA (
    CODIGO_VENDA  BIGINT NOT NULL,
    CODIGO_BOMBA  BIGINT NOT NULL,
    QUANTIDADE    FLOAT NOT NULL
);

RECREATE TABLE PRECOS (
    CODIGO              BIGINT NOT NULL,
    CODIGO_COMBUSTIVEL  BIGINT NOT NULL,
    UNIDADE             VARCHAR(10) NOT NULL,
    VRCUSTO             FLOAT NOT NULL,
    VRAVISTA            FLOAT NOT NULL,
    VRIMPOSTO           FLOAT NOT NULL
);

RECREATE TABLE TANQUES (
    CODIGO              BIGINT NOT NULL,
    CODIGO_COMBUSTIVEL  BIGINT NOT NULL,
    CAPACIDADE          FLOAT NOT NULL
);

RECREATE TABLE VENDAS (
    CODIGO  BIGINT NOT NULL,
    DATA    DATE
);



/******************************************************************************/
/*                                Primary keys                                */
/******************************************************************************/

ALTER TABLE BOMBAS ADD CONSTRAINT PK_BOMBAS PRIMARY KEY (CODIGO);
ALTER TABLE COMBUSTIVEIS ADD CONSTRAINT PK_COMBUSTIVEIS PRIMARY KEY (CODIGO);
ALTER TABLE PRECOS ADD CONSTRAINT PK_PRECOS PRIMARY KEY (CODIGO);
ALTER TABLE TANQUES ADD CONSTRAINT PK_TANQUES PRIMARY KEY (CODIGO);
ALTER TABLE VENDAS ADD CONSTRAINT PK_VENDAS PRIMARY KEY (CODIGO);


/******************************************************************************/
/*                                Foreign keys                                */
/******************************************************************************/

ALTER TABLE BOMBAS ADD CONSTRAINT FK_BOMBAS FOREIGN KEY (CODIGO_TANQUE) REFERENCES TANQUES (CODIGO);
ALTER TABLE ITENS_VENDA ADD CONSTRAINT FK_VENDAS FOREIGN KEY (CODIGO_VENDA) REFERENCES VENDAS (CODIGO);
ALTER TABLE PRECOS ADD CONSTRAINT FK_PRECOS FOREIGN KEY (CODIGO_COMBUSTIVEL) REFERENCES COMBUSTIVEIS (CODIGO);
ALTER TABLE TANQUES ADD CONSTRAINT FK_COMBUSTIVEL FOREIGN KEY (CODIGO_COMBUSTIVEL) REFERENCES COMBUSTIVEIS (CODIGO);


/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/

CREATE UNIQUE INDEX COMBUSTIVEIS_DESCRICAO_IDX ON COMBUSTIVEIS (DESCRICAO);


/******************************************************************************/
/*                                  Triggers                                  */
/******************************************************************************/



SET TERM ^ ;



/******************************************************************************/
/*                            Triggers for tables                             */
/******************************************************************************/



/* Trigger: SEQ_CODIGO_BOMBAS */
CREATE OR ALTER TRIGGER SEQ_CODIGO_BOMBAS FOR BOMBAS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
     IF (new.CODIGO is null) then
        new.CODIGO = gen_id(SEQ_CODIGO_BOMBAS,1);
END
^

/* Trigger: SEQ_CODIGO_COMBUSTIVEIS */
CREATE OR ALTER TRIGGER SEQ_CODIGO_COMBUSTIVEIS FOR COMBUSTIVEIS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
     IF (new.CODIGO is null) then
        new.CODIGO = gen_id(SEQ_CODIGO_COMBUSTIVEIS,1);
END
^

/* Trigger: SEQ_CODIGO_PRECOS */
CREATE OR ALTER TRIGGER SEQ_CODIGO_PRECOS FOR PRECOS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
     IF (new.CODIGO is null) then
        new.CODIGO = gen_id(SEQ_CODIGO_PRECOS,1);
END
^

/* Trigger: SEQ_CODIGO_TANQUES */
CREATE OR ALTER TRIGGER SEQ_CODIGO_TANQUES FOR TANQUES
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
     IF (new.CODIGO is null) then
        new.CODIGO = gen_id(SEQ_CODIGO_TANQUES,1);
END
^

/* Trigger: SEQ_CODIGO_VENDAS */
CREATE OR ALTER TRIGGER SEQ_CODIGO_VENDAS FOR VENDAS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
     IF (new.CODIGO is null) then
        new.CODIGO = gen_id(SEQ_CODIGO_VENDAS,1);
END
^
SET TERM ; ^
